\chapter{Przecięcie wielokątów}
Problem znalezienia przecięcia dla wielokątów wypukłych zdefiniujmy
następująco:

\begin{problem}[Znajdowanie przecięcia wielokątów]
  Gdy dane są dwa wielokąty wypukłe $P$ i $Q$, znaleźć ich
  \emph{przecięcie} tj.\ obszar należący jednocześnie do $P$ i do $Q$.
\end{problem}

W niniejszym rozdziale do wielokąta będziemy zaliczać jego wnętrze
wraz z brzegiem.

Oznaczmy jako $N$ liczbę wierzchołków $P$, a jako $M$ liczbę
wierzchołków $Q$. Stosując algorytm naiwny polegający na sprawdzeniu
przecięcia każdej krawędzi $P$ z każdą krawędzią $Q$ można uzyskać
punkty wszystkich przecięć w czasie $O(NM)$.

\section{Algorytm Shamos-Hoey}
Znaną metodą rozwiązywania problemów w algorytmice jest technika
\emph{dziel i rządź}, polegająca na podziale na mniejsze części,
znajdowaniu rozwiązań częściowych, a następnie łączeniu ich w końcowy
rezultat.

Metodę wykorzystującą podział płaszczyzny zaproponowali w 1976 Shamos
i Hoey. Przez każdy wierzchołek $P$ i $Q$ prowadzimy prostą równoległą
do osi $y$, tworząc w ten sposób $N+M$ warstw. Znalezienie przecięć
krawędzi obydwu wielokątów w każdej warstwie pozwoli nam na proste
wyznaczenie obszaru przecięcia tych wielokątów.

Należy zauważyć, że w każdej warstwie proste ją ograniczające wraz z
krawędziami wielokąta tworzą czworobok lub gdy jest to wierzchołek
skrajny na osi $x$ --- trójkąt. W pojedynczej warstwie przecięcie
dwóch czworoboków możemy wyznaczyć w czasie stałym. % Z twierdzenia
% \ref{thm:egdecollision} wiemy, że w każdej warstwie znajdziemy nie
% więcej niż dwa przecięcia.

% \begin{twierdzenie}
% \label{thm:egdecollision}
%   Jeżeli dwa wielokąty wypukłe $P$ i $Q$ przecinają się, to każda z
%   krawędzi $P$ przecina $Q$ co najwyżej dwa razy.
% \end{twierdzenie}

Następnie w czasie liniowym łączymy uzyskane kawałki i usuwamy
nadmiarowe wierzchołki powstałe przy podziale płaszczyzny. Początkowy
podział płaszczyzny również możemy przeprowadzić w czasie liniowym,
tak więc złożoność czasowa całego algorytmu wynosi $O(n)$.

\section{Algorytm O'Rourke-Chien-Olson-Naddor}
Kolejną metoda, zaproponowana przez O'Rourke, Chiena, Olsona i
Naddora (1982) jest rozwinięciem algorytmu naiwnego.

Załóżmy, że $P$ i $Q$ przecinają się, oraz oznaczmy ich przecięcie $P
\cap Q$ jako $R$ (\ref{fig:scythes}). Zauważmy, że brzeg $R$ składa
się naprzemiennie z krawędzi należących do $P$ i $Q$. Jeżeli dany
fragment brzegu $R$ należy do $Q$, to jest on ,,objęty'' na zewnątrz
przez fragment krawędzi $P$ i na odwrót, fragmenty brzegu $R$, które
należą do $P$ są otoczone przez krawędzie należące do $Q$.

Możemy zauważyć, że przechodząc w odpowiedniej kolejności,
jednocześnie po zewnętrznych i wewnętrznych krawędziach sierpa
ograniczymy sprawdzanie przecięć do krawędzi początkowych i końcowych
danego sierpa. Z tego względu przy wyborze krawędzi do której mamy
przejść w danym kroku, kierujemy się tym czy krawędź bieżąca może
zawierać przecięcie, które dopiero mają być wykryte.

Wybierzmy dowolną krawędź $p_{i-1}p_{i}$ z $P$ oraz dowolną krawędź
$q_{j-1}q_{j}$ z $Q$. Będziemy przechodzić po krawędziach obu
wielokątów w kierunku przeciwnym do ruch wskazówek zegara. W każdym
kroku sprawdzamy przecięcie bieżących krawędzi $P$ i $Q$, oraz
wybieramy krawędź do której podążymy w następnym kroku. Rozważmy
sytuację z rysunku \ref{fig:advance}. Wektor krawędzi $p_{i-1}p_{i}$
oznaczyliśmy jako $A$, a wektor krawędzi $q_{j-1}q_{j}$ jako $B$.
Krawędzie obu wielokątów mają szanse przeciąć się tylko, jeżeli ich
wektory są skierowane ku sobie. Ponadto, jeżeli $A \times B > 0$ i
$p_{i}$ leży w półpłaszczyźnie $H(B)$ zdefiniowanej jako obszar na
lewo od $B$, to wiemy, że powinniśmy przejść po krawędzi
$q_{j}q_{j+1}$. Tak samo w sytuacji, jeżeli $A \times B < 0$ i $p_{i}$
nie należy do $H(B)$. W przeciwnym przypadku przechodzimy po
$p_{i}p_{i+1}$.

Jeżeli $P$ i $Q$ przecinają się to przecięcie zostanie znalezione po
$O(L+M)$ krokach. Znając punkty przecięć dodatkowe $L+M$ kroków
wystarcza do wyznaczenia brzegów przecięcia. Możemy tym samym
stwierdzić, że jeżeli po $2(L+M)$ krokach nie odnajdziemy przecięcia
to krawędzie $P$ i $Q$ nie przecinają się.

\section{Algorytm Toussaint}
Stosunkowo prosty koncepcyjnie i implementacyjnie algorytm, działający
w czasie liniowym zaproponował Godfried T. Toussaint.

\subsection{Opis}
Rozważmy dwa przecinające się, wypukłe wielokąty $P$ i $Q$, oraz
otoczkę wypukłą sumy tych wielokątów $CH(P \cup Q)$ [rys]. Niech
brzegi $P$ i $Q$ przecinają się w $k$ punktach $I_1, I_2, \ldots, I_k$
ponumerowanych zgodnie z kierunkiem przeciwnym do ruchu wskazówek
zegara. Brzegi $P$ i $Q$ oraz otoczka wypukła $CH(P \cup Q)$ dzielą
płaszczyznę na $2k + 1$ ograniczonych regionów: obszar przecięcia
wielokątów $P \cap Q$ wyznaczony przez punkty $I_1, I_2, \ldots, I_k$,
$k$ regionów gdzie $P$ lub $Q$ należy do otoczki wypukłej $CH(P \cup
Q)$, ale nie należy do obszaru $P \cap Q$ przecięcia tych wielokątów
oraz analogiczne $k$ obszarów $K_1, K_2, \ldots, K_k$, które nazywać
będziemy \emph{kieszeniami}, leżących wewnątrz otoczki wypukłej $CH(P
\cup Q$), ale leżących na zewnątrz $P \cup Q$. Każdej kieszeni $K_v$
przypisujemy odpowiadający jej punkt przecięcia $I_v$ oraz krawędź
otoczki $CH(P \cup Q)$, którą będziemy nazywać \emph{mostem}, łączącą
wierzchołek $p_i$ wielokąta $P$ oraz wierzchołek $q_j$ wielokąta $Q$ i
oznaczymy ją jako $B_{v}(p_{i_v}, q_{j_v})$. Cały algorytm
wyznaczający przecięcie wielokątów $P$ i $Q$ można przedstawić w
trzech krokach (\ref{alg:interconpol}).

\begin{figure}[htp]
\begin{algorithmic}[1]
\Procedure{Alogrytm Interconpol}{}

\State \emph{(Krok 1)}

\State wyznacz otoczkę wypukłą $CH(P \cup Q)$

\State

\If {$CH(P \cup Q) = P$ (lub $Q$)}
    \State zwróć $Q$ (lub $P$) jako przecięcie

    \Else
    \State kontynuuj
\EndIf

\State

\State \emph{(Krok 2)}

\State \textbf{dla każdego} mostu z $CH(P \cup Q)$:
\State \hspace{\algorithmicindent} znajdź odpowiadający mu punkt
przecięcia

\State

\State \emph{(Krok 3)}

\State połącz wewnętrzne łańcuchy należące do $P$ i $Q$

wyznaczone przez punkty przecięcia z znalezione w poprzednim kroku

\EndProcedure
\end{algorithmic}
\caption{\label{alg:interconpol}}
\end{figure}


\subsection{Poprawność}
Poprawność algorytmu opiera się się na poniższych założeniach:

\begin{lemat}
  Jeżeli $P$ i $Q$ przecinają się to dla każdego mostu $CH(P \cup U)$
  istnieje jeden związany z nim punkt przecięcia $P \cap U$.
\end{lemat}

\begin{proof}
  Jako $L(u, v)$ oznaczmy skierowaną linię przechodzącą przez $u$ i
  $v$ w kierunku z $u$ do $v$, oraz jako $RH(u, v)$ oznaczmy
  półpłaszczyznę na prawo od $L(u, v)$. Analogicznie, jako $LH(u, v)$
  oznaczmy półpłaszczyznę leżącą na lewo od $L(u, v)$.

  Niech $B(p_i, q_j)$ będzie mostem (rys.). $L(p_i, q_j)$ jest linią
  wsparcia dla $P$ i $Q$ jednocześnie więc $P$ i $Q$ muszą leżeć w
  półpłaszczyźnie $RH(p_i, q_j)$. Przejdźmy po brzegu $P$ zaczynając
  od $p_i$ w kierunku zgodnym z ruchem wskazówek zegara dopóki nie
  natrafimy na krawędź $P$ przecinającą krawędź $Q$. Punkt przecięcia
  oznaczmy jako $I$. Analogicznie przejdźmy po brzegu $Q$ zaczynając
  od $q_j$ w kierunku przeciwnym do ruchu wskazówek zegara dopóki nie
  natrafimy na krawędź $Q$ przecinającą krawędź $P$. Z wypukłości obu
  wielokątów wynika, że tym razem punktem przecięcia również jest $I$
  i w ten sposób jest on związany z mostem $B(p_i, q_j)$.

  Z drugiej strony załóżmy, że $I$ jest pewnym punktem przecięcia
  pomiędzy krawędziami $(p_k, p_{k+1}) \in P$ i $(q_l, q_{l+1}) \in
  Q$. Ponieważ $P \in RH(p_k, p_{k+1})$ oraz $Q \in RH(q_l, q_{l+1})$,
  to żadna krawędź inna niż $(p_k, p_{k+1})$ i $(q_l, q_{l+1})$ nie
  może przecinać się w regionie $R = RH(p_{k+1}, p_k) \cap RH(q_{l+1},
  q_l)$. Dodatkowo, ponieważ $\angle p_{k}Iq_{l+1} < 180^{\circ}$ musi
  istnieć krawędź $(p_i, q_j) \in CH(P \cup Q)$, która przecina region
  $R$ i jest nią most odpowiadający punktowi przecięcia $I$.
\end{proof}

\begin{lemat}
  Algorytm poprawnie wyznacza punkt przecięcia dla odpowiadającego mu
  mostu.
\end{lemat}

\begin{proof}
  Zauważmy, że każda kieszeń wraz z odpowiadającym jej mostem oraz
  punktem przecięcia $I_i$ tworzy wielokąt \emph{żaglokształtny}.

  \begin{definicja}
    Wielokątem \emph{żaglokształtnym} $P_s$ będziemy nazywać wielokąt
    zawierający krawędź $(p_{i}p_{i+1})$ będącą \emph{masztem} $P$
    oraz wierzchołek $p_j$, który będziemy nazywać $czubkiem żagla$,
    połączony z wierzchołkami $p_i$ i $p_{i+1}$ \emph{łańcuchami
      wklęsłymi}.
  \end{definicja}

  \begin{definicja}
    Łańcuchem $C(p_i,p{i+1},\ldots,p_j)$ będziemy nazywać ciąg
    kolejnych, następujących po sobie krawędzi i wierzchołków
    wielokąta prostego zaczynając od wierzchołka $p_i$ do wierzchołka
    $p_j$. Jeżeli każda krawędź łańcucha wraz z następną krawędzią
    tworzy kąt prawoskrętny to taki łańcuch nazywamy
    \emph{wypukłym}. Analogicznie, jeżeli każda krawędź wraz ze swoim
    następnikiem tworzy kąt lewoskrętny to taki łańcuch nazywamy
    \emph{łańcuchem wklęsłym}.
  \end{definicja}

  Ponadto zauważmy, również:

  \begin{lemat}\label{lem:sailtip}
    Czubek wielokąta żaglokształtnego jest \emph{uchem}.
  \end{lemat}

  \begin{definicja}\label{def:ear}
    Niech $p_i, p_{i+1}, p_{i+2}$ będą trzema kolejnymi, następującymi
    po sobie wierzchołkami należącymi do wielokąta $P$. Jeżeli
    \emph{przekątna} łącząca $p_{i}$ i $p_{i+2}$ leży w $P$ to punkt
    $p_i$ nazywamy \emph{uchem} wielokąta $P$.
  \end{definicja}

  \begin{definicja}
    Odcinek leżący wielokącie $P$ i łączący dwa, nie sąsiadujące
    wierzchołki $P$ nazywamy \emph{przekątną} $P$.
  \end{definicja}

  \begin{proof}
    Rozszerzmy krawędź $(p_j,p_{j-1})$ i $(p_j, p_{j+1})$ tak by
    przecinały linię $L(p_i, p_{i+1})$ odpowiednio w punktach $x$ i
    $y$ (rys.). Ze względu na to, że $p_j$ jest połączony z $p_i$
    łańcuchem wypukłym punkt $x$ musi leżeć odcinku $(p_i, p_{i+1})$
    będącym masztem $P$. Analogicznie, punkt $y$ musi leżeć na maszcie
    $P$. Punkty $p_j, p_{j-1}, x, y, p_{j+1}, p_j$, tworzą obszar
    znajdujący się w całości w $P$, stąd przekątna $(p_{j-1},
    p_{j+1})$ również musi leżeć w $P$.
  \end{proof}

  \begin{twierdzenie}[G.H. Meisters 1975]\label{thm:meisters}
    Każdy wielokąt o $n$ krawędziach ($n > 3$) ma co najmniej dwoje nie
    nachodzących na siebie uszu.
  \end{twierdzenie}

  \begin{lemat}\label{lem:sailmast}
    Uchem jest góra masztu wielokąta żaglokształtnego albo uchem jest
    jego dół.
  \end{lemat}

  \begin{proof}
    Z definicji~\ref{def:ear} wiemy, że tylko wierzchołki wypukłe mogą
    być uszami, a więc w wielokącie żaglokształtnym $P$ uszami mogą
    być jedynie $p_i$, $p_{i+1}$, i $p_j$. Z lematu~\ref{lem:sailtip}
    wiemy, że $p_j$ musi być uchem. Z twierdzenia~\ref{thm:meisters}
    wiemy, że $P$ musi mieć co najmniej dwoje uszu. Stąd albo $p_i$
    albo $p_{i+1}$ musi być uchem.
  \end{proof}

  Lemat~\ref{lem:sailtip} pozwala nam na triangulację $P$ w każdym
  kroku obcinając ucho będące górą lub dołem masztu dopóki nie
  dojdziemy do czubka żagla i krawędzi z niego
  wychodzących. Poprawność wynika z faktu, że w każdym kroku po
  obcięciu kolejnego ucha, pozostała cześć wielokąta również jest
  wielokątem żaglokształtnym.
\end{proof}

W naszym przypadku wierzchołek $p_j$ jest szukanym punktem przecięcia
$I_i$, tak więc dodatkowo w algorytmie powinniśmy uwzględnić warunek
sprawdzający czy w bierzącym kroku nadal rozważamy krawędź należącą do
wielokąta żaglokształtnego. Kompletny algorytm znajdujący czubek żagla
wielokąta $P$ został przedstawiony na listingu~\ref{alg:stepdown}.

\begin{figure}[htp]
\begin{algorithmic}[1]
\Procedure{Stepdown}{}

\State $i \gets 1$
\State $j \gets 1$

% \State

\Repeat
\State $koniec \gets true$

% \State

\While{$\angle p_{i}p_{i+1}q_{j+1}$ jest lewoskrętny}
\State $j \gets j + 1$
\State $koniec \gets false$
\EndWhile

% \State

\While{$\angle q_{j}q_{j+1}p_{i+1}$ jest prawoskrętny}
\State $i \gets i + 1$
\State $koniec \gets false$
\EndWhile

\Until{$koniec$}

% \State

\State $p_s \gets p_i$
\State $q_t \gets q_j$

\EndProcedure
\end{algorithmic}
\caption{\label{alg:stepdown}}
\end{figure}

Wejściem dla procedury jest most $B_k(p_i,p_j)$ należący do $CH(P \cup
Q)$, a wyjściem para wierzchołków $p_s$ i $q_t$, gdzie $(p_s,p_{s+1})
\cap (q_t,q_{t+1})$ wyznacza punkt przecięcia $I_k$. Warunek $\angle
p_{i}p_{i+1}q_{j+1}$ \emph{jest lewoskrętny} oraz $\angle
q_{j}q_{j+1}p_{i+1}$ \emph{jest prawoskrętny} w pętlach \textbf{while}
zapewnia, że w każdym kroku odetniemy ucho oraz, że nie przejdziemy
przez czubek żagla. Przebieg procedury \emph{Stepdown} przedstawia
rys..

\subsection{Złożoność}
Niech $n$ oznaczana liczbę wierzchołków wielokąta $P$, a $m$ liczbę
wierzchołków wielokąta $Q$. Znalezienie otoczki wypukłej dwóch
przecinających się wielokątów wypukłych może być wykonane w czasie
$O(m + n)$ [ref]. Autor algorytmu, Godfried Toussaint proponuje
wykorzystać algorytm \emph{obracających się suwmiarek (rotating
  calipers)}[ref], pozwalający w tym samym czasie stwierdzić czy $CH(P
\cup Q) = P$ lub $CH(P \cup Q) = Q$.

Procedura znajdująca przecięcie $I_k$ jest wywoływana $k$ razy. Każde
wywołanie wymaga czasu liniowego zależnego od liczby wierzchołków
należących do danego żagla. Wszystkich takich wierzchołków może być
maksymalnie $n + m$, stąd ta część algorytmu wymaga czasu $O(n + m)$.

Ostatnią część algorytmu, połączenie uzyskanych \emph{łańcuchów
  wewnętrznych} można wykonać w czasie liniowym przechodząc przez
krawędzie obydwu wielokątów, jeżeli podczas szukania punktów przecięć
oznaczyliśmy kierunek w którym dana część wielokąta staje się
łańcuchem wewnętrznym.

Stąd złożoność czasowa całego algorytmu wynosi $O(n + m)$.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "masterthesis"
%%% TeX-engine: xetex
%%% End:
